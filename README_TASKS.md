# Задание 1: Анализ и проектирование

## Подзадание 1.1: Анализ и планирование

Схема `monolith-context.puml`

### Функциональность текущего монолитного приложения

Текущее монолитное приложение предназначено для управления системами отопления в домах пользователей. Основная
функциональность включает:

- Управление отоплением:
    - Пользователи могут удалённо включать и выключать отопление в своих домах.
    - Пользователи могут устанавливать желаемую температуру.
    - Система автоматически поддерживает заданную температуру, регулируя подачу тепла на основе данных, полученных с
      датчиков температуры.
- Мониторинг температуры:
    - Система получает данные о текущей температуре с датчиков, установленных в домах пользователей.
    - Пользователи могут просматривать текущую температуру в своих домах через веб-интерфейс.

### Архитектуры монолитного приложения

1. Язык программирования: Приложение написано на `Java`.
2. База данных: Используется `PostgreSQL` для хранения данных о пользователях, системах отопления, и их настройках.
3. Архитектура: Монолитная архитектура, в которой все компоненты системы (обработка запросов, бизнес-логика, работа с
   данными) находятся в рамках одного приложения.
4. Взаимодействие: Все взаимодействия внутри системы синхронные, без использования асинхронных вызовов, микросервисов
   или реактивного программирования. Взаимодействие с датчиками также происходит через синхронные запросы.
5. Масштабируемость: Ограниченная масштабируемость, так как монолит сложно разделить и масштабировать по отдельным
   частям. Для масштабирования требуется разворачивать новые экземпляры всего приложения.
6. Развертывание: Развертывание требует остановки всего приложения. Обновление или изменение кода требует остановки всей
   системы и её перезапуска, что делает обновления сложными и рискованными.

### Домены и границы контекстов

В соответствии с принципами Domain-Driven Design (DDD), можно выделить следующие домены и границы контекстов:

#### Домены:

1. Управление устройствами (Heating Control): Этот домен отвечает за включение и выключение отопления, настройку
   температуры и автоматическое регулирование подачи тепла.
2. Мониторинг температуры (Temperature Monitoring): Этот домен отвечает за сбор данных о текущей температуре с датчиков
   и предоставление этой информации пользователям.
3. Управление пользователями (User Management): Этот домен отвечает за регистрацию, аутентификацию,
   авторизацию пользователей, управление их учетными записями, а также за предоставление ролей и прав
   доступа для совместного использования оборудования.
4. Автоматизация управления (Automation Management): Этот домен отвечает за создание и управление
   автоматическими сценариями работы системы, позволяющими пользователям настраивать автоматические
   действия, такие как включение/выключение отопления, освещения, открытия ворот
   и другие действия на основе заранее определенных условий.

#### Границы контекстов:

1. Контекст управления устройствами: Включает логику управления отоплением и настройками, взаимодействие с датчиками для
   регулирования температуры.
2. Контекст мониторинга температуры: Включает взаимодействие с датчиками для получения данных о температуре и
   предоставление этих данных пользователям через веб-интерфейс.
3. Контекст управления пользователями: Включает функциональность, связанную с управлением
   учетными записями, аутентификацией и авторизацией пользователей, а также администрированием
   прав доступа.
4. Контекст автоматизации управления: Включает логику создания и управления сценариями
   автоматизации, позволяющими пользователям задавать правила и условия, по которым система
   будет автоматически управлять устройствами.

## Подзадание 1.2: Архитектура микросервисов

Созданы диаграммы

- `microservices-code-device.puml`
- `microservices-code-telemetry.puml`
- `microservices-components-devices.puml`
- `microservices-components-telemetry.puml`
- `microservices-containers.puml`

## Подзадание 1.3: ER-диаграмма

Создана диаграмма

- `ER.puml`

## Подзадание 1.4: Создание и документирование API

В проектах `device-management` и `telemetry` в корне можно найти файлы
`openapi.yaml` и `asyncapi.yaml`

`openapi.yaml` был сгенерирован автоматически через плагин

# Задание 2: Разработка MVP

## Подзадание 2.1: Новые микросервисы и интеграция с монолитом

Разработаны 2 микросервиса `device-management` и `telemetry`

Оба на языке `Java` с использованием `Spring Boot`

В качестве БД с целью упрощения разработки и развертывания выбрана H2. Благодаря Spring заменить БД на другую не
представляется сложным, достаточно просто передать новые параметры для подключения через переменные среды.

## Подзадание 2.2: Подготовка 3rd party сервисов для связи микросервисов

В docker-compose.yaml добавлен api-gateway KONG и кластер kafka

# Задание 3: Автоматизация поставки (опционально)

## Подзадание 3.1: Контейнеризация микросервисов

В docker-compose.yaml добавлены сервисы `device-management` и `telemetry` 
